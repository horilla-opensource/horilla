{% load i18n %}
{% for perm in permissions %}
        <div class="border border-[#ebebeb] rounded-md overflow-hidden mb-2">
            <button
                class="inner-accordion-toggle w-full text-sm font-semibold bg-[#f3f3f3] px-4 py-3 text-[#333] flex items-center gap-2 perm-accordion" onclick="event.preventDefault()">
                <span>{{perm.app}}</span>
                <span
                    class="oh-badge permission-badge bg-primary-600 text-white px-2 py-1 rounded-full text-xs">0</span>
            </button>


            <div class="panel inner-accordion-content transition-all duration-300 overflow-auto bg-white relative"
                style="max-height: 0; opacity: 0;">

                <div class="p-4 pt-0">
                    <table class="w-full">
                        <!-- Table Head -->
                        <thead class="top-0 bg-white text-left sticky z-[2]">
                            <tr class="border-b border-[#ececec]">
                                <!-- Select All Checkbox -->
                                <th class="w-12 text-sm font-medium text-left p-3">
                                    <input
                                        type="checkbox"
                                        class="custom-checkbox w-4 h-4 bg-[#E9EDF7] rounded-sm text-[#e54f38] cursor-pointer row-permission__select-all"
                                        id="id{{perm.app}}Permissions"
                                        onchange="selectAllPermissions(this)"
                                    >
                                </th>

                                <!-- Actions Label -->
                                <th class="text-sm font-medium p-3">
                                    {% trans "Actions" %}
                                </th>

                                <!-- Create Icon -->
                                <th class="text-lg text-center font-medium p-3" title="{% trans 'Can create' %}">
                                    <i class="fa-regular fa-square-plus"></i>
                                </th>

                                <!-- View Icon -->
                                <th class="text-lg text-center font-medium p-3" title="{% trans 'Can view' %}">
                                    <i class="fa-solid fa-eye"></i>
                                </th>

                                <!-- Edit Icon -->
                                <th class="text-lg text-center font-medium p-3" title="{% trans 'Can edit' %}">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </th>

                                <!-- Delete Icon -->
                                <th class="text-lg text-center font-medium p-3" title="{% trans 'Can delete' %}">
                                    <i class="fa-solid fa-trash"></i>
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for model in perm.app_models %}
                                {% if model.model_name not in no_permission_models %}
                                    <tr class="border-b border-[#f3f3f3]">
                                        <!-- Checkbox -->
                                        <td class="left text-sm text-left p-3 text-[#666]">
                                            <input
                                                type="checkbox"
                                                id="id_{{perm.app}}{{model.model_name}}"
                                                class="custom-checkbox w-4 h-4 bg-[#E9EDF7] rounded-sm text-[#e54f38] cursor-pointer row-permission"
                                                onchange="
                                                    $(this).closest('tr').find('[type=checkbox][name=permissions]').prop('checked', $(this).is(':checked')).change();
                                                ">
                                        </td>

                                        <!-- Model Info -->
                                        <td class="text-sm text-center p-3 text-[#666]">
                                            <div class="flex gap-3 items-center w-max">
                                                <img
                                                    src="https://ui-avatars.com/api/?name={{model.verbose_name}}&background=random"
                                                    alt="{{model.verbose_name}}"
                                                    width="30"
                                                    class="w-6 h-6 rounded-full"
                                                >
                                                <span>{{ model.verbose_name }}</span>
                                            </div>
                                        </td>

                                        <!-- Can Create -->
                                        <td class="text-sm text-center p-3 text-[#666]">
                                            <label class="toggle-label">
                                                <input
                                                    type="checkbox"
                                                    class="toggle-input"
                                                    name="permissions"
                                                    value="add_{{model.model_name}}"
                                                    data-group-id="{{group.id}}"
                                                    data-group-name="{{group.name}}"
                                                    onchange="
                                                        if (!$(this).is(':checked')) {
                                                            $(this).closest('tr').find('.row-permission').prop('checked', false)
                                                        }
                                                    "
                                                >
                                                <div class="toggle-switch"></div>
                                            </label>
                                        </td>

                                        <!-- Can View -->
                                        <td class="text-sm text-center p-3 text-[#666]">
                                            <label class="toggle-label">
                                                <input
                                                    type="checkbox"
                                                    class="toggle-input view-permission"
                                                    name="permissions"
                                                    value="view_{{model.model_name}}"
                                                    data-group-id="{{group.id}}"
                                                    data-group-name="{{group.name}}"
                                                    onchange="
                                                        if (!$(this).is(':checked')) {
                                                            $(this).closest('tr').find('.row-permission').prop('checked', false)
                                                        }
                                                    "
                                                >
                                                <div class="toggle-switch"></div>
                                            </label>
                                        </td>

                                        <!-- Can Edit -->
                                        <td class="text-sm text-center p-3 text-[#666]">
                                            <label class="toggle-label">
                                                <input
                                                    type="checkbox"
                                                    class="toggle-input"
                                                    name="permissions"
                                                    value="change_{{model.model_name}}"
                                                    data-group-id="{{group.id}}"
                                                    data-group-name="{{group.name}}"
                                                    onchange="
                                                        if (!$(this).is(':checked')) {
                                                            $(this).closest('tr').find('.row-permission').prop('checked', false)
                                                        }
                                                    "
                                                >
                                                <div class="toggle-switch"></div>
                                            </label>
                                        </td>

                                        <!-- Can Delete -->
                                        <td class="text-sm text-center p-3 text-[#666]">
                                            <label class="toggle-label">
                                                <input
                                                    type="checkbox"
                                                    class="toggle-input"
                                                    name="permissions"
                                                    value="delete_{{model.model_name}}"
                                                    data-group-id="{{group.id}}"
                                                    data-group-name="{{group.name}}"
                                                    onchange="
                                                        if (!$(this).is(':checked')) {
                                                            $(this).closest('tr').find('.row-permission').prop('checked', false)
                                                        }
                                                    "
                                                >
                                                <div class="toggle-switch"></div>
                                            </label>
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
{% endfor %}
