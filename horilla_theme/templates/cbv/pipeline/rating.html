{% load i18n recruitmentfilters horillafilters %}
 <style>
    .rating-radio {
      display: none;
    }

    .star-group {
      display: flex;
      flex-direction: row-reverse; /* This flips visual order */
      gap: 2px;
    }

    .star-label {
      font-size: 20px;
      color: #dfdfdf;
      cursor: pointer;
      transition: color 0.2s ease-in-out;
    }

    .rating-radio:checked ~ label.star-label {
      color: #FFA800;
    }

    .star-group input[type="radio"]:checked ~ label.star-label {
      color: #FFA800;
    }

    .star-label:hover,
    .star-label:hover ~ .star-label {
      color: #FFA800;
    }
  </style>


 <div onclick="event.stopPropagation()">
   {% with request.user.employee_get.candidate_rating.all as candidate_ratings %}
   {% if candidate_ratings|has_candidate_rating:instance %}
   <form hx-swap="none" hx-post='{% url "update-candidate-rating" instance.id %}' method="post">
     {% csrf_token %}
     <div class="d-block mb-0" style="width: max-content;">
       <div class="oh-rate star-group" onclick="$(this).closest('form').find('button').click()">
         {% for i in "54321" %}
         <input type="radio" id="star{{i}}{{instance.id}}" name="rating" class="rating-radio"
           value="{{i}}" {% if candidate_ratings|rating:instance == i %} checked {% endif %} />
         <label for="star{{i}}{{instance.id}}" class="star-label" title="{{i}} Stars">
            &#9733;
         </label>
         {% endfor %}
       </div>
       <button type="submit" hidden></button>
       <span id="rating-radio-error"></span>
     </div>
   </form>
   {% else %}
   <form hx-swap="none" hx-post='{% url "create-candidate-rating" instance.id %}' method="post">
     {% csrf_token %}
     <div class="d-block mb-0" style="width: max-content;">
       <div class="oh-rate star-group" onclick="$(this).closest('form').find('button').click()">
         {% for i in "54321" %}
         <input type="radio" id="star{{i}}{{instance.id}}" name="rating" class="rating-radio" value="{{i}}" />
         <label for="star{{i}}{{instance.id}}" class="star-label" title="{{i}} Stars">&#9733;</label>
         {% endfor %}
       </div>
       <button type="submit" hidden></button>
       <span id="rating-radio-error"></span>
     </div>
   </form>
   {% endif %}
   {% endwith %}
 </div>


  {% comment %} {% load i18n recruitmentfilters horillafilters %}
<style>
  .star-rating {
    display: flex;
    flex-direction: row-reverse;
    gap: 6px;
  }

  .star-rating input[type="radio"] {
    display: none;
  }

  .star-rating label {
    cursor: pointer;
    font-size: 1.5rem;
    color: #dfdfdf;
    transition: color 0.2s;

  }
  .star-wrapper{
    flex-direction: row-reverse; /* This flips visual order */
  }

  .star-rating input:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: #FFA800;
  }
</style>

{% load i18n recruitmentfilters horillafilters %}
<div onclick="event.stopPropagation()">
  {% with request.user.employee_get.candidate_rating.all as candidate_ratings %}
    {% if candidate_ratings|has_candidate_rating:instance %}
      <form
        hx-post="{% url 'update-candidate-rating' instance.id %}"
        method="post"
        hx-swap="none"
        id="rating-form-{{ instance.id }}"
      >
        {% csrf_token %}
        <div class="d-block mb-0" style="width: max-content;">
          <div class="flex gap-2 text-lg ps-4 mb-4 star-wrapper">
            {% for i in "54321" %}
              {% with star_value=forloop.counter|stringformat:"s" %}
                <input
                  type="radio"
                  id="star{{ star_value }}-{{ instance.id }}"
                  name="rating"
                  value="{{ star_value }}"
                  class="hidden peer"
                  {% if candidate_ratings|rating:instance == star_value %} checked {% endif %}
                />
                <label
                  for="star{{ star_value }}-{{ instance.id }}"
                  class="cursor-pointer text-[#dfdfdf] peer-checked:text-[#FFA800] hover:text-[#FFA800] transition"
                >
                  <i class="fa-solid fa-star"></i>
                </label>
              {% endwith %}
            {% endfor %}
          </div>
        </div>
      </form>
    {% else %}
      <form
        hx-post="{% url 'create-candidate-rating' instance.id %}"
        method="post"
        hx-swap="none"
        id="rating-form-{{ instance.id }}"
      >
        {% csrf_token %}
        <div class="d-block mb-0" style="width: max-content;">
          <div class="flex gap-2 text-lg ps-4 mb-4 star-wrapper">
            {% for i in "54321" %}
              {% with star_value=forloop.counter|stringformat:"s" %}
                <input
                  type="radio"
                  id="star{{ star_value }}-{{ instance.id }}"
                  name="rating"
                  value="{{ star_value }}"
                  class="hidden peer"
                />
                <label
                  for="star{{ star_value }}-{{ instance.id }}"
                  class="cursor-pointer text-[#dfdfdf] peer-checked:text-[#FFA800] hover:text-[#FFA800] transition"
                >
                  <i class="fa-solid fa-star"></i>
                </label>
              {% endwith %}
            {% endfor %}
          </div>
        </div>
      </form>
    {% endif %}
  {% endwith %}
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.star-wrapper input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function () {
          const form = this.closest("form");
          if (form) {
            form.querySelector("button[type='submit']")?.click();
          }
        });
      });
    });
  </script>
   {% endcomment %}
