{% load i18n static %}
{% include 'filter_tags.html' %}

<style>
.oh-faq__tag:hover {
    filter: brightness(90%);
}
</style>
    {% for faq in faqs %}
    <div class="accordion-item border border-primary-300 rounded-md" x-data="{open:false, menu:false}" id="faqItem{{faq.id}}">

        <!-- Accordion Header -->
        <button
            class="accordion-btn w-full flex justify-between items-center px-4 py-2 text-sm transition-all bg-[#fff5f1] text-[#e54f38]"
            @click="open = !open"
        >
            {% comment %} <span class="font-medium">{{ faq.question }}</span>

            <!-- Tags -->
            <ul class=" flex-wrap gap-1">
                {% for tag in faq.tags.all %}
                <li
                    class="px-2 py-0.5 rounded-full text-xs font-medium text-white"
                    style="background: {{ tag.color }};"
                >
                    {{ tag|capfirst }}
                </li>
                {% endfor %}
            </ul> {% endcomment %}

            <div class="flex flex-col gap-1">
                <!-- Question -->
                <span class="font-medium" style="text-align: left;">
                    {{ faq.question }}
                </span>

                <!-- Tags under question -->
                <ul class="flex flex-wrap gap-2">
                    {% for tag in faq.tags.all %}
                    <li
                        class="px-2 py-0.5 rounded-full text-xs font-medium text-white"
                        style="background: {{ tag.color }};"
                    >
                        {{ tag|capfirst }}
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div>
                <!-- Dropdown -->
                <div class="relative inline-block" x-data="{ menu:false }" @click.stop>
                    <a class="cursor-pointer" @click="menu = !menu">
                        <i class="fa-solid fa-ellipsis-vertical text-black"></i>
                    </a>

                    <!-- Dropdown menu -->
                    <div
                        x-show="menu"
                        x-transition
                        @click.away="menu = false"
                        class="absolute right-0 min-w-[100px] bg-white rounded-lg shadow-card py-2 z-50"
                    >
                        <ul class="text-xs">
                            <li>
                                <a
                                    hx-get="{% url 'faq-update' faq.id %}"
                                    hx-target="#objectCreateModalTarget"
                                    data-toggle="oh-modal-toggle"
                                    data-target="#objectCreateModal"
                                    class="w-full text-dark-600 flex justify-start text-left px-3 py-1 hover:text-primary-600 transition duration-300"
                                >
                                    {% trans "Edit" %}
                                </a>
                            </li>
                            <li>
                                <form id="delete-faq-form-{{ faq.id }}"
                                    hx-post="{% url 'faq-delete' faq.id %}"
                                    hx-confirm="{% trans 'Are you sure you want to delete this FAQ?' %}"
                                    style="display: inline;"
                                    hx-target="#faqItem{{ faq.id }}"
                                    hx-swap="outerHTML swap:.5s"
                                    hx-on-htmx-after-request="setTimeout(() => {reloadMessage(this);}, 100);">

                                    {% csrf_token %}

                                    <a href="#"
                                        class="w-full text-dark-600 flex justify-start text-left px-3 py-1 hover:text-primary-600 transition duration-300"
                                        @click.prevent="submitDeleteFaq({{ faq.id }}); menu=false">
                                        Delete
                                    </a>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>


                <span class="icon text-xl font-bold ps-3">+</span>
            </div>
        </button>

        <!-- Accordion Body -->
        <div
            class="accordion-panel max-h-0 overflow-hidden transition-all duration-300 bg-white px-4 text-sm text-gray-700"
            x-ref="panel"
            x-bind:style="open ? 'max-height:' + $refs.panel.scrollHeight + 'px' : 'max-height:0'"
        >
            <div class="py-3">
                <div class="text-sm text-[#565E6C]">
                    {{ faq.answer|linebreaksbr }}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="flex justify-center items-center h-[70vh]">
        <div class="oh-404 text-center">
            <img src="{% static 'images/ui/faq.png' %}" class="mb-4 oh-404__image" alt="">
            <h3 class="text-lg">{% trans "There are no FAQs at the moment." %}</h3>
        </div>
    </div>
    {% endfor %}

<script>
    function submitDeleteFaq(faqId) {
        const form = document.getElementById(`delete-faq-form-${faqId}`);
        if (form) {
        form.requestSubmit(); // triggers HTMX + hx-confirm
        }
    }

    $(document).ready(function () {
        $("#filterForm").find("select").select2({
            width: '100%'
        });
    });
</script>
