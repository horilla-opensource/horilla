{% extends "index.html" %}
{% load i18n %}
{% load static %}
{% load basefilters %}
{% load horillafilters %}

{% block content %}
    {% include "generic/components.html" %}

    <div class="oh-checkpoint-badge mb-2"
    id="selectedInstances"
    data-ids="[]"
    data-clicked=""
    style="display: none">
    </div>
    <div class="oh-checkpoint-badge mb-2"
    id="shiftselectedInstancesIndividual"
    data-ids="[]"
    data-clicked=""
    style="display: none">
    </div>
    <div class="oh-wrapper"
        hx-get="/employee/profile{{ request.path }}?{{ request.GET.urlencode }}&instance_ids={{ request.GET.instance_ids }}"
        hx-trigger="load">
    </div>
    <div
    class="oh-modal"
    id="groupAssign"
    role="dialog"
    aria-labelledby="groupAssign"
    aria-hidden="true"
  >
    <div class="oh-modal__dialog" >
      <div class="oh-modal__dialog-header">
        <h2 class="oh-modal__dialog-title" id="editModal1ModalLabel">
          {% trans "Employee Group Assign" %}
        </h2>
        <button class="oh-modal__close" aria-label="Close" onclick="$(this).closest('.oh-modal--show').removeClass('oh-modal--show'); event.preventDefault()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>
      <div class="oh-modal__dialog-body" id="groupAssignBody">

      </div>
    </div>
  </div>

    <script>
        $(document).ready(function () {
            var exists = $("#view-container").find(".oh-general__tab-link--active").length;
            if (!exists) {
                $("#view-container").find(".oh-general__tab-link")[0].click();
            }
        });

        toggleColumns("employee-tab", "fieldContainerTable");

        if (!localStorage.getItem("employee_tab")) {
            $("#fieldContainerTable").find("[type=checkbox]").prop("checked", true).change();
        }

        function handleFormSubmit() {
            $('#successMessage').show();
            setTimeout(function () {
                $('#successMessage').hide();
            }, 3000);
            return false; // Prevent the default form submission
        }

        function submitForm(elem) {
            $(elem).siblings('.add_more_submit').click();
        }

        function enlargeDoc(src, $element) {
            var enlargeDocContainer = $element.parents().closest("li").find("#enlargeDocContainer");
            enlargeDocContainer.empty();
            var style = 'width:100%; height:90%; box-shadow: 0 10px 10px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.2); background:white';
            var enlargedImage = $('<iframe>').attr({ src: src, style: style });
            var name = $('<span>').text(src.split('/').pop().replace(/_/g, ' '));
            enlargeDocContainer.append(enlargedImage);
            enlargeDocContainer.append(name);
            setTimeout(function () {
                enlargeDocContainer.show();
                const iframe = document.querySelector('iframe').contentWindow;
                var iframe_document = iframe.document;
                var iframe_image = iframe_document.getElementsByTagName('img')[0];
                $(iframe_image).attr('style', 'width:100%; height:100%;');
            }, 100);
        }

        function checkSelected(names, target, initial = false) {
            names = JSON.parse(`${names}`);
            $.each(names, function (indexInArray, valueOfElement) {
                if (!initial) {
                    $(target).find(`[value=${valueOfElement}]`).prop("checked", true).change();
                } else {
                    $(target).find(`[value=${valueOfElement}]`).prop("checked", true);
                }
            });
        }

        function updateBadge(element = false) {
            var panels = $(".panel");
            $.each(panels, function (indexInArray, valueOfElement) {
                var check = $(valueOfElement).find("[name=permissions]:checked").length;
                $(valueOfElement).prev().find(".oh-badge.permission-badge").html(check);
                $(valueOfElement).prev().find(".oh-badge.permission-badge").attr("title", check + " Permissions");
            });

            var permissionLine = $(".oh-sticky-table__tr");
            $.each(permissionLine, function (index, value) {
                var check = $(value).find("[name=permissions]:checked").length;
                if (check === 4) {
                    $(value).find(".row-permission").prop("checked", true);
                }
            });

            var permissionApps = $(".oh-sticky-table__tbody");
            $.each(permissionApps, function (index, value) {
                var total_permission_count = $(value).find("[name=permissions]").length;
                var checked_permission_count = $(value).find("[name=permissions]:checked").length;
                if (checked_permission_count === total_permission_count) {
                    $(this).siblings(".oh-sticky-table__thead").find(".row-permission__select-all").prop("checked", true);
                } else {
                    $(this).siblings(".oh-sticky-table__thead").find(".row-permission__select-all").prop("checked", false);
                }
            });
        }

        function hideEnlargeDoc() {
            var enlargeDocContainer = $('.enlargeDocContainer');
            enlargeDocContainer.empty();
        }

        $(document).on('click', function (event) {
            if (!$(event.target).closest('#enlargeDocContainer').length) {
                hideEnlargeDoc();
            }
        });
        {% if "attendance"|app_installed %}
        function validateHours(url) {
            $.ajax({
                url: "{% url 'active-tab' %}",
                method: "GET",
                data: {
                    path: "{% url 'attendances-tab-view' %}",
                    target: `li[data-target="#attendances-tab1"]`
                },
                success: function(response) {
                    window.location.href = url;
                },
                error: function(xhr, status, error) {
                    console.error(error);
                }
            });
        }

        function validateOTHours(url) {
            $.ajax({
                url: "{% url 'active-tab' %}",
                method: "GET",
                data: {
                    path: "{% url 'attendances-tab-view' %}",
                    target: `li[data-target="#attendances-tab2"]`
                },
                success: function(response) {
                    window.location.href = url;
                },
                error: function(xhr, status, error) {
                    console.error(error);
                }
            });
        }
        {% endif %}

        {% if request.GET.deleted %}
        $('#reloadMessagesButton').click();
        {% endif %}
    </script>



<!-- Inline styles -->
<style>
    .oh-general__tab {
		margin-bottom: 15px;
	 }
	 .resign-status {
		background: #73bbe12b;
		font-size: 0.8rem;
		padding: 4px 8px;
		border-radius: 10px;
		margin-bottom: 6px;
		font-weight: 600;
		color: #357579;
		}
    .file-upload {
		margin-top: 6px !important;
		width: 34px !important;
		height: 34px !important;
		font-size: 1.75rem !important;
	 }
    .enlarge-image-container {
		display: none;
		position: fixed;
		top: 40%;
		left: 40%;
		transform: translate(-50%, -50%);
		width: 30%;
		height: 50%; z-index: 9999;
	}
    .enlarge-image-container img {
		max-width: 100%;
		height: auto;
		border-radius: 5%; }
    .oh-sticky-table {
		max-height: 65vh;
	}

    .oh-sticky-table__sd {
		z-index: 11 !important;
	}
    .oh-sticky-table__right {
		position: sticky; right: 0;
		background-color: #fff;
	}
    .oh-sticky-table__top {
		z-index: 12 !important;
		top: 0; }
    .oh-modal_close--custom {
		border: none;
		background: none;
		font-size: 1.5rem;
		opacity: 0.7;
		position: absolute;
		top: 25px;
		right: 15px;
	}
    .oh-tabs__tablist .oh-tabs__tab--active:nth-last-child(2) {
		border-right: 1px solid hsl(213deg, 22%, 84%);
	}
    .custom-dialog {
		max-width: 1000px;
		max-height: 800px;
	}
    .file-validation {
		color: #4f5bd9;
		background-color: #d8e7f0;
		border-color: #d6e9c6;
		padding: 15px; border: 1px solid
		transparent; border-radius: 4px; }
    .oh-not-found {
		display: flex; justify-content: center;
		align-items: center;
		flex-direction: column;
		height: 50vh; opacity: 0.5;
	}

	.custom-dialog {
		max-width: 1000px;
		max-height: 800px;
	}
    body {
		background-color: #f9f9f9 !important;
	}
    .draft--dot {
		background-color: grey;
	}
    .review_ongoing--dot {
		background-color: orange;
	}
    .confirmed--dot {
		background-color: rgb(103, 171, 238);
	}
    .paid--dot {
		background-color: green;
	}
    .status-draft {
		border-left: 3.4px solid grey !important; border-radius: 4px 0 0 4px;
	}
    .status-review_ongoing {
		border-left: 3.4px solid orange !important;
		border-radius: 4px 0 0 4px;
	}
    .status-confirmed {
		border-left: 3.4px solid rgb(103, 171, 238) !important;
		border-radius: 4px 0 0 4px;
	}
    .status-paid {
		border-left: 3.4px solid green !important;
		border-radius: 4px 0 0 4px;
	}
    .sent-to-employee {
		background-color: yellowgreen;
		color: white;
	}
    .at_risk--dot {
		background-color: red;
	}
    .not_started--dot {
		background-color: grey;
	}
    .behind--dot {
		background-color: orange;
	}
    .closed--dot {
		background-color: rgb(103, 171, 238);
	}
    .on_track--dot {
		background-color: yellowgreen;
	}
    .status-At.Risk {
		border-left: 3.4px solid red !important;
		border-radius: 4px 0 0 4px;
	}
    .status-Not.Started {
		border-left: 3.4px solid grey !important;
		border-radius: 4px 0 0 4px;
	}
    .status-Behind {
		border-left: 3.4px solid orange !important;
		border-radius: 4px 0 0 4px; }
    .status-Closed {
		border-left: 3.4px solid rgb(103, 171, 238) !important;
		border-radius: 4px 0 0 4px;
	}
    .status-On.Track {
		border-left: 3.4px solid yellowgreen !important;
		border-radius: 4px 0 0 4px;
	}
    .status-rejected {
		border-left: 4px solid red !important;
		border-radius: 5px 0 0 4px;
	}
    .status-cancelled {
		border-left: 4px solid grey !important;
		border-radius: 5px 0 0 4px;
	}
    .status-requested {
		border-left: 4px solid orange !important;
		border-radius: 5px 0 0 4px;
	}
    .status-approved {
		border-left: 4px solid yellowgreen !important;
		border-radius: 5px 0 0 4px;
	}
    .approved--dot{
        background-color:yellowgreen;
      }
      .canceled--dot{
        background-color:red;
      }
      .requested--dot{
        background-color:orange;
      }
      .approved-True{
        border-left: 3.4px solid yellowgreen !important;
        border-radius: 4px 0 0 4px;

      }
      .canceled-True {

        border-left: 3.4px solid red !important;
        border-radius: 4px 0 0 4px;

      }
      .requested-False-False {

        border-left: 3.4px solid orange !important;
        border-radius: 4px 0 0 4px;

      }
      .validated--dot{
        background-color:yellowgreen;
      }
      .not-validated--dot{
        background-color:rgba(128, 128, 128, 0.482);
      }

      .validated-True{
        border-left: 3.4px solid yellowgreen !important;
        border-radius: 4px 0 0 4px;

      }
      .validated-False {

        border-left: 3.4px solid rgba(128, 128, 128, 0.482) !important;
        border-radius: 4px 0 0 4px;


      }
      .bulk-request--dot {

        background-color:rgb(31 122 220 / 48%);
      }
    .diff-cell{
      background: rgba(255, 166, 0, 0.158);
    }
    .validated--dot{
        background-color:yellowgreen;
      }
      .not-validated--dot{
        background-color:rgba(128, 128, 128, 0.482);
      }


</style>

<div id="enlargeImageContainer"></div>

<script src="{% static 'employee/search.js' %}"></script>
<script src="{% static 'basedOn.js' %}"></script>
<script>
	$(document).ready(function () {
		var exits = $("#view-container").find(".oh-general__tab-link--active").length;
		if (!exits) {
			$("#view-container").find(".oh-general__tab-link")[0].click()
		}
	});

	toggleColumns("employee-tab", "fieldContainerTable")
	if (!localStorage.getItem("employee_tab")) {
		$("#fieldContainerTable").find("[type=checkbox]").prop("checked", true).change()
	}

	function handleFormSubmit() {

		$('#successMessage').show();

		setTimeout(function () {
			$('#successMessage').hide();
		}, 3000);

		return false; // Prevent the default form submission
	}

</script>
<script>
	function submitForm(elem) {
		$(elem).siblings('.add_more_submit').click()
	}
	function enlargeDoc(src, $element) {
		var enlargeDocContainer = $element.parents().closest("li").find("#enlargeDocContainer")
		enlargeDocContainer.empty()
		style = 'width:100%; height:90%; box-shadow: 0 10px 10px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.2); background:white'
		var enlargedImage = $('<iframe>').attr({ src: src, style: style })
		var name = $('<span>').text(src.split('/').pop().replace(/_/g, ' '))
		enlargeDocContainer.append(enlargedImage)
		enlargeDocContainer.append(name)
		setTimeout(function () {
			enlargeDocContainer.show()

			const iframe = document.querySelector('iframe').contentWindow
			var iframe_document = iframe.document
			iframe_image = iframe_document.getElementsByTagName('img')[0]
			$(iframe_image).attr('style', 'width:100%; height:100%;')
		}, 100)
	}
	function checkSelected(names, target, initial = false) {
        names = JSON.parse(`${names}`);
        $.each(names, function (indexInArray, valueOfElement) {
            if (!initial) {
                $(target)
                    .find(`[value=${valueOfElement}]`)
                    .prop("checked", true)
                    .change();
            } else {
                $(target).find(`[value=${valueOfElement}]`).prop("checked", true);
            }
        });
    }
	function updateBadge(element = false) {
        var panels = $(".panel");
        $.each(panels, function (indexInArray, valueOfElement) {
            var check = $(valueOfElement).find("[name=permissions]:checked").length;
            $(valueOfElement).prev().find(".oh-badge.permission-badge").html(check);
            $(valueOfElement).prev().find(".oh-badge.permission-badge").attr("title", check + " Permissions");
        });

        var permissionLine = $(".oh-sticky-table__tr");
        $.each(permissionLine, function (index, value) {
            var check = $(value).find("[name=permissions]:checked").length;
            if (check === 4) {
                $(value).find(".row-permission").prop("checked", true);
            }
        })

        var permissionApps = $(".oh-sticky-table__tbody")
        $.each(permissionApps, function (index, value) {
            var total_permission_count = $(value).find("[name=permissions]").length;
            var checked_permission_count = $(value).find("[name=permissions]:checked").length
            if (checked_permission_count === total_permission_count) {
                $(this).siblings(".oh-sticky-table__thead").find(".row-permission__select-all").prop("checked", true);
            } else {
                $(this).siblings(".oh-sticky-table__thead").find(".row-permission__select-all").prop("checked", false)
            }
        })
    }
	function hideEnlargeDoc() {
		var enlargeDocContainer = $('.enlargeDocContainer')
		enlargeDocContainer.empty()
	}

	$(document).on('click', function (event) {
		if (!$(event.target).closest('#enlargeDocContainer').length) {
			hideEnlargeDoc()
		}
	})
</script>

{% endblock content %}
