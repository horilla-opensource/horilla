{% load i18n %}
<div class="oh-modal__dialog-header">
    <button type="button" class="oh-modal__close" aria-label="Close">
        <ion-icon name="close-outline"></ion-icon>
    </button>
</div>

<!-- htmx form -->
<div class="oh-modal__dialog-body">
    <form
        hx-post="{% url 'create-reimbursement' %}?{% if form.instance.id %}instance_id={{form.instance.id}}{% endif %}"
        hx-target="#objectCreateModalTarget"
        hx-encoding="multipart/form-data"
    >
        {% if form.type.value == 'medical_encashment' or request.GET.type == 'medical_encashment' or form.initial.type == 'medical_encashment' or form.instance.type == 'medical_encashment' %}
            {% include 'payroll/reimbursement/medical_form_fields.html' with employee=form.employee %}
        {% else %}
            {{ form.as_p }}
        {% endif %}
    </form>
    <table
        class="oh-table oh-table--sortable" {% if not form.instance.id or form.instance.type == "reimbursement" or form.instance.type == "medical_encashment" or form.instance.type == "bonus_encashment" %}
        id="availableTable"
        style="display: none"
        {% endif %}
    >
        <thead>
            <tr>
                <th>{% trans "Leave Type" %}</th>
                <th>{% trans "Available Days" %}</th>
                <th title=" {% trans 'Carry Forward Days' %}">{% trans "CFD" %}</th>
            </tr>
        </thead>
        <tbody
            {% if not form.instance.id %}
            id="availableTableBody"
            {% endif %}
        >
            {% for available_leave in form.assigned_leaves %}
            <tr class="toggle-highlight">
                <td>{{available_leave.leave_type_id}}</td>
                <td>{{available_leave.available_days}}</td>
                <td>{{available_leave.carryforward_days}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
<script>
    // Enlarge modal for medical form and enable type switching via HX
    (function(){
        try{ $("#objectCreateModal #objectCreateModalTarget").css("max-width","1200px"); }catch(e){}
        var sel = document.querySelector('#objectCreateModalTarget [name="type"]');
        if (sel){ sel.addEventListener('change', function(){
            var v = this.value;
            var url = '{% url 'create-reimbursement' %}?type=' + encodeURIComponent(v){% if form.instance.id %} + '&instance_id={{form.instance.id}}'{% endif %};
            if (window.htmx){ htmx.ajax('GET', url, {target:'#objectCreateModalTarget'}); }
            else if (window.jQuery){ $("#objectCreateModalTarget").load(url); }
        });}
    })();
</script><script>
    toggleReimbursmentType($("#objectCreateModalTarget [name=type]").first());
    removeHighlight();
</script>
</div>







