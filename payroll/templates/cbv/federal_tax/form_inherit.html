{% load i18n %}
<div>
    {% include "generic/horilla_form.html" %}
</div>
<iframe
style="display: none;"
frameBorder="0"
height="450px"
id="oc-editor"
src="https://onecompiler.com/embed/python?codeChangeEvent=true&hideNew=true&hideNewFileOption=true&hideStdin=true&hideTitle=true&listenToEvents=true&availableLanguages=false&theme=dark"
width="100%"
>
</iframe>
<script>
    var iFrame = document.getElementById('oc-editor');

    // Make sure the iframe is fully loaded before sending the postMessage
    iFrame.onload = function() {
        // Populate the code in the OneCompiler editor
        iFrame.contentWindow.postMessage({
            eventType: 'populateCode',
            language: 'python',
            files: [
              {
                "name": "federal_tax.py",
                "content": `{{form.instance.python_code|safe}}`
              }
            ]
        }, "*");

        // Trigger the code to run
        iFrame.contentWindow.postMessage({
            eventType: 'triggerRun'
        }, "*");
    };
    window.onmessage = function (e) {
          if (e.data && e.data.language) {
              code = e.data.files[0].content
              $("[name=python_code]").html(code);
          }
      };
   </script>
   <script>
    $("[name=python_code]").parent().parent().hide();
    $("[name=use_py]").change();
   </script>
