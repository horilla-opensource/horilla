{% load i18n %}
{% if task_id in request.managing_offboarding_tasks or perms.offboarding.change_employeetask or perms.offboarding.change_offboardingtask or instance.stage_id.pk in request.managing_offboarding_stages or instance.stage_id.offboarding_id.pk in request.managing_recruitments or request.user.employee_get == instance.employee_id %}
    <div
        onclick="event.stopPropagation()"
        id="taskContainer{{ task_id }}{{ instance.pk }}"
    >
        {% if task %}
            <select
                hx-get="{% url 'update-task-status' %}?stage_id={{instance.stage_id.pk}}&employee_ids={{instance.id}}&task_id={{task_id}}"
                name="task_status"
                id="task_status{{task.id}}"
                hx-swap="none"
                hx-on-htmx-after-request="$('#reloadMessagesButton').click();$(`#offboardingStageContainer{{instance.stage_id.pk}}`).find('.reload-record').click()"
                name="status"
                class="w-100"
                style="
                    border: 1px solid hsl(213deg, 22%, 84%);
                    padding: 0.3rem 0.8rem 0.3rem 0.3rem;
                    border-radius: 0rem;
                "
            >
                {% for choice in task.statuses %}
                    {% if choice.0 == task.status %}
                        <option value="{{ choice.0 }}" selected>{{ choice.1 }}</option>
                    {% else %}
                        <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        {% else %}
            <button
                class="oh-checkpoint-badge text-info"
                data-toggle="oh-modal-toggle"
                hx-get="{% url 'offboarding-assign-task' %}?employee_ids={{instance.id}}&task_id={{task_id}}"
                hx-swap="none"
                hx-on-htmx-after-request="$(`#offboardingStageContainer{{instance.stage_id.pk}}`).find('.reload-record').click();"
            >
                {% trans 'Assign' %}
            </button>
        {% endif %}
    </div>
{% else %}
    {{ task.get_status_display }}
{% endif %}
